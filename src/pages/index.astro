---
import Layout from "../layouts/Layout.astro";
import Project from "../components/Project.astro";
import {
  CodepenLogo,
  BracketsCurly,
  Code,
  GithubLogo,
  TwitterLogo,
  Envelope,
  At,
  File,
} from "phosphor-react";
---

<Layout title="Stephen Purdue">
  <main class="pb-32">
    <div
      class="bg-nord0 dark:bg-nord1 py-8 grid grid-auto-rows phone:grid-rows-[1fr] phone:grid-cols-[1fr_max-content_max-content_1fr] gap-4"
    >
      <div class="phone:col-start-2 flex justify-center">
      </div>
      <div
        class="phone:col-start-3 flex items-center justify-center flex-col text-white"
      >
        <h1 class="font-bold tablet:text-6xl text-5xl text-center">
          Stephen Purdue
        </h1>
        <span class="font-bold tablet:text-4xl text-3xl text-center"
          >Software Engineer</span
        >
      </div>
    </div>
    <div class="flex">
      <div class="grow h-[4px] bg-nord11"></div>
      <div class="grow h-[4px] bg-nord12"></div>
      <div class="grow h-[4px] bg-nord13"></div>
      <div class="grow h-[4px] bg-nord14"></div>
      <div class="grow h-[4px] bg-nord9"></div>
    </div>
    <div class="flex justify-center flex-wrap pt-6 gap-4 px-4">
      <a
        href="mailto:stephendpurdue@gmail.com"
        target="_blank"
        rel="noopener noreferrer"
        class="p-4 rounded-full transition-all shadow shadow-transparent bg-nord6 dark:bg-nord5 hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:-translate-y-1 hover:shadow-md active:translate-y-0 text-nord0"
        aria-label="Email"
      >
        <Envelope size={24} weight="bold" />
      </a>
      </a>
      <a
        href="https://x.com/stephendpurdue"
        target="_blank"
        rel="noopener noreferrer"
        class="p-4 rounded-full transition-all shadow shadow-transparent bg-nord6 dark:bg-nord5 hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:-translate-y-1 hover:shadow-md active:translate-y-0 text-nord0"
        aria-label="Twitter"
      >
        <TwitterLogo size={24} weight="bold" />
      </a>
      <a
        href="https://github.com/stephendpurdue"
        target="_blank"
        rel="noopener noreferrer"
        class="p-4 rounded-full transition-all shadow shadow-transparent bg-nord6 dark:bg-nord5 hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:-translate-y-1 hover:shadow-md active:translate-y-0 text-nord0"
        aria-label="GitHub"
      >
        <GithubLogo size={24} weight="bold" />
      </a>
      <a
        href="/documents/Stephen Purdue CV.pdf"
        download="Stephen Purdue CV.pdf"
        target="_blank"
        rel="noopener noreferrer"
        class="p-4 rounded-full transition-all shadow shadow-transparent bg-nord6 dark:bg-nord5 hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:-translate-y-1 hover:shadow-md active:translate-y-0 text-nord0"
        aria-label="Resume"
      >
        <File size={24} weight="bold" />
      </a>
    </div>
    <div class="flex justify-center gap-4 py-6">
      <button
        data-target="projects"
        class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord9 text-white font-bold hover:bg-nord0 dark:hover:bg-nord6 hover:text-white dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
      >
        Projects
      </button>
      <button
        data-target="about"
        class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord6 dark:bg-nord5 dark:text-nord0 text-nord0 font-bold hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
      >
        About Me
      </button>
      <button
        data-target="university"
        class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord6 dark:bg-nord5 dark:text-nord0 text-nord0 font-bold hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
      >
        University
      </button>
    </div>
    <div
      data-name="projects"
      class="px-4 mx-auto w-full max-w-6xl grid phone:grid-cols-2 tablet:grid-cols-3 laptop:grid-cols-4 gap-4"
    >
      <Project
        name="Expense Tracker"
        description="Budgeting tool created using Python and Pandas."
        icon="/images/piechart.svg"
        link="https://github.com/stephendpurdue/ExpenseTracker"
      />

      <Project
        name="Slackers"
        description="Vertical Slice created for third year Client Project, in collaboration with RaRa Games."
        icon="/images/controller.svg"
        link="https://github.com/stephendpurdue/Slackers"
      />
    </div>
    <div data-name="about" class="hidden">
      <div class="mx-auto max-w-2xl px-4">
        <p class="text-lg text-white">
          Hi, I'm Stephen Purdue. I've been studying as a Game Developer for
          the last 4 years working in Unity and Unreal Engine, I'm learning Python,
          JavaScript, and React in order to pursue a career in Software Engineering. 
          I am passionate about solving problems and understanding new programming languages.
          While my core skill set is Game Development, I have found a love
          for Machine Learning and Artificial Intelligence. Learning new technologies is
          always an exciting opportunity and I enjoy building new things with them.
        </p>
      </div>
    </div>
    <div data-name="university" class="hidden">
      <div class="mx-auto max-w-6xl px-4 flex flex-col gap-6">
        <div class="text-center">
          <h2 class="text-3xl font-bold text-white">University Projects</h2>
        </div>
        <div
          class="grid gap-4 phone:grid-cols-2 tablet:grid-cols-2 laptop:grid-cols-4"
        >
          <details
            class="group rounded-2xl border border-nord6/40 bg-nord0/60 p-4 text-white shadow transition hover:border-nord9 focus-within:border-nord9"
          >
            <summary
              class="flex w-full cursor-pointer list-none items-start justify-between gap-3 text-left font-semibold"
            >
        <div>
                <p>Major Research Project</p>
                <span class="text-sm font-normal text-nord6">Semester 1 - 2025</span>
              </div>
              <div class="flex items-center gap-2">
                <a
                  href="/documents/Stephen Purdue CV.pdf"
                  download="Major Research Project.pdf"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord6 dark:bg-nord5 dark:text-nord0 text-nord0 text-xs font-bold hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
                >
                  Download
                </a>
                <span
                  class="rounded-full bg-nord9/20 px-2 py-1 text-xs font-bold text-nord9 transition group-open:bg-nord9 group-open:text-nord0"
                  >Open</span
                >
              </div>
            </summary>
            <div class="mt-4 space-y-3 text-sm text-nord6">
              <p>
                
              </p>
              <ul class="list-disc space-y-1 pl-5">
              </ul>
              <iframe
                src="/documents/Stephen Purdue CV.pdf"
                class="w-full h-[900px] rounded-lg border border-nord6/40"
                title="Major Research Project PDF"
              ></iframe>
            </div>
          </details>
          <details
            class="group rounded-2xl border border-nord6/40 bg-nord0/60 p-4 text-white shadow transition hover:border-nord9 focus-within:border-nord9"
          >
            <summary
              class="flex w-full cursor-pointer list-none items-start justify-between gap-3 text-left font-semibold"
            >
              <div>
                <p>Enterprise Focus</p>
                <span class="text-sm font-normal text-nord6">Semester 1 - 2025</span>
              </div>
              <div class="flex items-center gap-2">
                <a
                  href="/documents/Stephen Purdue CV.pdf"
                  download="Enterprise Focus.pdf"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord6 dark:bg-nord5 dark:text-nord0 text-nord0 text-xs font-bold hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
                >
                  Download
                </a>
                <span
                  class="rounded-full bg-nord9/20 px-2 py-1 text-xs font-bold text-nord9 transition group-open:bg-nord9 group-open:text-nord0"
                  >Open</span
                >
              </div>
            </summary>
            <div class="mt-4 space-y-3 text-sm text-nord6">
              <p>
               
              </p>
              <p>
               
              </p>
              <iframe
                src="/documents/Stephen Purdue CV.pdf"
                class="w-full h-[900px] rounded-lg border border-nord6/40"
                title="Enterprise Focus PDF"
              ></iframe>
            </div>
>>>>>>> 4cef502dfb053bcccb59cd99a24481b8117c90c7
          </details>
          <details
            class="group rounded-2xl border border-nord6/40 bg-nord0/60 p-4 text-white shadow transition hover:border-nord9 focus-within:border-nord9"
          >
            <summary
              class="flex w-full cursor-pointer list-none items-start justify-between gap-3 text-left font-semibold"
            >
              <div>
                <p>Client Project: 'Slackers'</p>
                <span class="text-sm font-normal text-nord6">Semester 1 - 2025</span>
              </div>
              <div class="flex items-center gap-2">
                <a
                  href="/documents/Stephen Purdue CV.pdf"
                  download="Client Project - Slackers.pdf"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord6 dark:bg-nord5 dark:text-nord0 text-nord0 text-xs font-bold hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
                >
                  Download
                </a>
                <span
                  class="rounded-full bg-nord9/20 px-2 py-1 text-xs font-bold text-nord9 transition group-open:bg-nord9 group-open:text-nord0"
                  >Open</span
                >
              </div>
            </summary>
            <div class="mt-4 space-y-3 text-sm text-nord6">
              <p>
                
              </p>
              <p>
                
              </p>
              <iframe
                src="/documents/Stephen Purdue CV.pdf"
                class="w-full h-[900px] rounded-lg border border-nord6/40"
                title="Client Project: 'Slackers' PDF"
              ></iframe>
            </div>
          </details>
          <details
            class="group rounded-2xl border border-nord6/40 bg-nord0/60 p-4 text-white shadow transition hover:border-nord9 focus-within:border-nord9"
          >
            <summary
              class="flex w-full cursor-pointer list-none items-start justify-between gap-3 text-left font-semibold"
            >
              <div>
                <p>Final Project</p>
                <span class="text-sm font-normal text-nord6">Semester 2 - 2026</span>
              </div>
              <div class="flex items-center gap-2">
                <a
                  href="/documents/Stephen Purdue CV.pdf"
                  download="Final Project.pdf"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="px-4 py-2 rounded-full shadow shadow-transparent bg-nord6 dark:bg-nord5 dark:text-nord0 text-nord0 text-xs font-bold hover:bg-nord6 dark:hover:bg-nord6 hover:text-nord0 dark:hover:text-nord0 hover:shadow-md hover:-translate-y-1 active:translate-y-0 active:shadow-transparent transition-all"
                >
                  Download
                </a>
                <span
                  class="rounded-full bg-nord9/20 px-2 py-1 text-xs font-bold text-nord9 transition group-open:bg-nord9 group-open:text-nord0"
                  >Open</span
                >
              </div>
            </summary>
            <div class="mt-4 space-y-3 text-sm text-nord6">
              <p>
               
              </p>
              <p>
                
              </p>
              <iframe
                src="/documents/Stephen Purdue CV.pdf" 
                class="w-full h-[900px] rounded-lg border border-nord6/40"
                title="Final Project PDF"
              ></iframe>
            </div>
          </details>
        </div>
      </div>
    </div>
  </main>

  <style>
    button[data-target],
    a[aria-label] {
      background-color: #ECEFF4 !important; /* nord6 */
      color: #2E3440 !important; /* nord0 */
    }
    
    @media (prefers-color-scheme: dark) {
      button[data-target],
      a[aria-label] {
        background-color: #D8DEE9 !important; /* nord5 */
        color: #2E3440 !important; /* nord0 */
      }
    }
    
    button[data-target].bg-nord9 {
      background-color: #88C0D0 !important; /* nord9 */
      color: #FFFFFF !important;
    }
    
    /* PDF iframe styling */
    iframe {
      background-color: #ECEFF4; /* nord6 */
      min-height: 500px;
    }
    
    @media (max-width: 640px) {
      iframe {
        height: 500px !important;
      }
    }
    
    @media (prefers-color-scheme: dark) {
      iframe {
        background-color: #4C566A; /* nord4 */
      }
    }
  </style>

  <script type="module">
    const buttons = document.querySelectorAll("button[data-target]");

    let activeButton;
    let activeSection;

    const styles = {
      button: {
        active: ["bg-nord9", "text-white"],
        inactive: [
          "bg-nord6",
          "dark:bg-nord5",
          "text-nord0",
          "dark:text-nord0",
        ],
      },
    };

    const style = (element, { add = [], remove = [] }) => {
      for (const removed of remove) {
        element.classList.remove(removed);
      }

      for (const added of add) {
        element.classList.add(added);
      }
    };

    let transition = (target) => {
      const button = document.querySelector(`button[data-target="${target}"]`);
      const section = document.querySelector(`div[data-name="${target}"]`);

      if (!activeButton || !activeSection) {
        // Transition without fade out
        style(button, {
          add: styles.button.active,
          remove: styles.button.inactive,
        });

        section.classList.remove("hidden");

        activeButton = button;
        activeSection = section;
      } else {
        // Transition with fade out
        style(activeButton, {
          add: styles.button.inactive,
          remove: styles.button.active,
        });
        style(button, {
          add: styles.button.active,
          remove: styles.button.inactive,
        });

        activeSection.classList.add("hidden");
        section.classList.remove("hidden");

        activeButton = button;
        activeSection = section;
      }
    };

    const onButtonClick = (event) => {
      const target = event.target.getAttribute("data-target");
      transition(target);
    };

    for (const button of buttons) {
      button.addEventListener("click", onButtonClick);
    }

    // #region agent log setup
    const agentLog = (message, data, hypothesisId = "H?") => {
      fetch("http://127.0.0.1:7242/ingest/0c0a3f32-2a52-4ed5-9cb3-d4d78fff2131", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          sessionId: "debug-session",
          runId: "retry4",
          hypothesisId,
          location: "src/pages/index.astro",
          message,
          data: {
            userAgent: navigator.userAgent,
            ...data,
          },
          timestamp: Date.now(),
        }),
      }).catch(() => {});
    };
    // #endregion

    // #region agent log helpers
    const logIframeMetrics = (hypothesisId) => {
      const iframes = document.querySelectorAll("div[data-name='university'] iframe");
      iframes.forEach((iframe, idx) => {
        const rect = iframe.getBoundingClientRect();
        const cs = window.getComputedStyle(iframe);
        agentLog("iframe-metrics", {
          index: idx,
          clientWidth: iframe.clientWidth,
          clientHeight: iframe.clientHeight,
          offsetWidth: iframe.offsetWidth,
          offsetHeight: iframe.offsetHeight,
          rectWidth: rect.width,
          rectHeight: rect.height,
          computedWidth: cs.width,
          computedHeight: cs.height,
          devicePixelRatio: window.devicePixelRatio,
          sectionHidden: iframe.closest("div[data-name='university']")?.classList.contains("hidden"),
          viewportWidth: window.innerWidth,
        }, hypothesisId);
      });
    };
    // #endregion

    // Stash iframe src to avoid Safari rendering PDFs while hidden
    const iframePlaceholders = new WeakMap();
    const stashIframeSrc = () => {
      const iframes = document.querySelectorAll("div[data-name='university'] iframe");
      iframes.forEach((iframe) => {
        if (!iframePlaceholders.has(iframe)) {
          iframePlaceholders.set(iframe, iframe.getAttribute("src"));
          iframe.removeAttribute("src");
        }
      });
      agentLog("iframes-stashed", { count: iframes.length }, "H4");
    };

    const restoreIframeSrc = () => {
      const iframes = document.querySelectorAll("div[data-name='university'] iframe");
      iframes.forEach((iframe, idx) => {
        if (iframePlaceholders.has(iframe) && !iframe.getAttribute("src")) {
          const src = iframePlaceholders.get(iframe);
          iframe.setAttribute("src", src);
          agentLog("iframe-restored", { index: idx, src }, "H5");
        }
      });
      logIframeMetrics("H5");
    };

    agentLog("page-init", {}, "H1");
    window.addEventListener("resize", () => logIframeMetrics("H2"));

    stashIframeSrc();
    transition("projects");

    // #region agent log after initial layout
    requestAnimationFrame(() => {
      logIframeMetrics("H3");
    });
    // #endregion

    // Restore PDF iframes when University tab is shown
    const originalTransition = transition;
    transition = (target) => {
      const result = originalTransition(target);
      if (target === "university") {
        restoreIframeSrc();
      }
      return result;
    };
  </script>
</Layout>
